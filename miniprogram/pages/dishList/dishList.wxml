<!--pages/dishList/dishList.wxml-->
<view class="container">
  <!-- èœç³»å¯¼èˆªï¼ˆé¡¶éƒ¨ï¼‰ -->
  <view class="cuisine-bar">
    <scroll-view class="cuisine-scroll" scroll-x>
      <view class="cuisine-list">
        <view 
          class="cuisine-item {{activeCuisine === item.cuisine_code ? 'active' : ''}}"
          wx:for="{{cuisines}}"
          wx:key="cuisine_code"
          data-code="{{item.cuisine_code}}"
          bindtap="switchCuisine"
        >
          {{item.cuisine}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ä¸»ä½“å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»å¯¼èˆª -->
    <scroll-view class="category-nav" scroll-y>
      <view 
        class="category-nav-item {{activeCategory === item.category_code ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="category_code"
        data-code="{{item.category_code}}"
        bindtap="scrollToCategory"
      >
        <view class="category-name">{{item.category}}</view>
      </view>
    </scroll-view>

    <!-- å³ä¾§èœå“åˆ—è¡¨ -->
    <scroll-view 
      class="dish-content" 
      scroll-y
      scroll-into-view="{{scrollIntoView}}"
      scroll-with-animation="{{true}}"
      bindscroll="onScroll"
    >
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading" wx:if="{{loading}}">
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- æŒ‰åˆ†ç±»åˆ†ç»„æ˜¾ç¤ºèœå“ -->
      <block wx:else>
        <view 
          class="category-group"
          wx:for="{{dishesGroupedByCategory}}"
          wx:key="category_code"
          id="category-{{item.category_code}}"
        >
          <!-- åˆ†ç±»æ ‡é¢˜ -->
          <view class="category-title">
            <view class="title-text">{{item.category}}</view>
            <view class="title-line"></view>
          </view>

          <!-- è¯¥åˆ†ç±»ä¸‹çš„èœå“ -->
          <view class="dish-list">
            <view 
              class="dish-item"
              wx:for="{{item.dishes}}"
              wx:for-item="dish"
              wx:key="_id"
            >
              <!-- èœå“å›¾ç‰‡ -->
              <image 
                class="dish-image" 
                src="{{dish.image}}" 
                mode="aspectFill"
                bindtap="viewDetail"
                data-id="{{dish._id}}"
              ></image>

              <!-- èœå“ä¿¡æ¯ -->
              <view class="dish-info" bindtap="viewDetail" data-id="{{dish._id}}">
                <view class="dish-name">{{dish.name}}</view>
                <view class="dish-desc" wx:if="{{dish.description}}">{{dish.description}}</view>
              </view>

              <!-- æ·»åŠ æŒ‰é’® -->
              <view class="dish-action">
                <button class="add-btn" bindtap="addToCart" data-dish="{{dish}}">
                  +
                </button>
              </view>
            </view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty" wx:if="{{dishesGroupedByCategory.length === 0}}">
          <text>è¯¥èœç³»æš‚æ— èœå“</text>
        </view>

        <!-- åº•éƒ¨å®‰å…¨å ä½ï¼Œç¡®ä¿æœ€åçš„å†…å®¹ä¸è¢«è´­ç‰©è½¦æ é®æŒ¡ -->
        <view class="bottom-safe-area"></view>
      </block>
    </scroll-view>
  </view>

  <!-- è´­ç‰©è½¦æŒ‰é’®ï¼ˆåº•éƒ¨ï¼‰ -->
  <view class="cart-bar" bindtap="goToCart">
    <view class="cart-info">
      <view class="cart-icon">
        ğŸ›’
        <view class="cart-count" wx:if="{{totalCount > 0}}">{{totalCount}}</view>
      </view>
      <text class="cart-text">å·²é€‰ {{totalCount}} é“èœ</text>
    </view>
    <view class="cart-btn">å»ç¡®è®¤</view>
  </view>
</view>
